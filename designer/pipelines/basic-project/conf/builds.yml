linux-libs:
  stage: one
  extends:
    - .linux-dev
  before_script:
    - ./configure --prefix=/usr
  script:
    - make -j libs
    - DESTDIR=./inst make install
  artifacts:
    paths:
      - inst/
    reports:
      junit:
        - tests/results.xml

linux-tools:
  stage: two
  extends:
    - .linux-dev
  needs:
    - linux-libs
  before_script:
    - make -j load-libs
  script:
    - make -j tools
    - make test
  artifacts:
    paths:
      - inst/tools

windows-tools:
  stage: one
  extends:
    - .windows-2020
  script:
    - msbuild tools.sln
  artifacts:
    paths:
      - inst/tools

installer:
  stage: three
  extends:
    - .linux-dev
  needs:
    - windows-tools
    - linux-tools
  script:
    - ./mk-installers.sh
  artifacts:
    paths:
      - inst/installers